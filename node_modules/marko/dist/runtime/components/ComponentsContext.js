"use strict";
var GlobalComponentsContext = require("./GlobalComponentsContext");

function ComponentsContext(out, parentComponentsContext) {
  var globalComponentsContext;
  var componentDef;

  if (parentComponentsContext) {
    globalComponentsContext = parentComponentsContext.e_;
    componentDef = parentComponentsContext.j_;

    var nestedContextsForParent;
    if (
    !(nestedContextsForParent = parentComponentsContext._R_))
    {
      nestedContextsForParent = parentComponentsContext._R_ = [];
    }

    nestedContextsForParent.push(this);
  } else {
    globalComponentsContext = out.global.b_;
    if (globalComponentsContext === undefined) {
      out.global.b_ = globalComponentsContext =
      new GlobalComponentsContext(out);
    }
  }

  this.e_ = globalComponentsContext;
  this.b_ = [];
  this.z_ = out;
  this.j_ = componentDef;
  this._R_ = undefined;
  this.p_ =
  parentComponentsContext && parentComponentsContext.p_;
}

ComponentsContext.prototype = {
  A_: function (host) {
    var componentDefs = this.b_;

    ComponentsContext._S_(componentDefs, host);

    this.z_.emit("_T_");

    // Reset things stored in global since global is retained for
    // future renders
    this.z_.global.b_ = undefined;

    return componentDefs;
  } };


function getComponentsContext(out) {
  return out.b_ || (out.b_ = new ComponentsContext(out));
}

module.exports = exports = ComponentsContext;

exports.o_ = getComponentsContext;